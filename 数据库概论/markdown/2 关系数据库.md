# **一、关系数据库的结构及形式化定义**

## 1. 关系

关系模型的三个组成部分：关系数据结构、关系操作集合、关系完整性约束

- 域：
    - 一组具有相同数据类型的值的集合。
- 笛卡尔积
    - 域的组合，给定一组域$D_1,D_2,…,D_n$允许其中某些域是相同的。
    - 所有域的所有取值的一个组合 
    - 不能重复
- 笛卡尔积没有实际意义，笛卡尔积的某个子集才有实际意义，关系是笛卡尔积的子集
- $D_1,D_2,…,D_n$的笛卡尔积为：
    - $D_1×D_2×…×D_n={(d_1,d_2,…,d_n)|d_i∈D_i,i=1,2,…,n}$
- 元组（Tuple）
    - 笛卡尔积中每一个元素$(d_1,d_2,…,d_n)$叫作一个𝑛n元组
- 分量（Component）
    - 笛卡尔积元素$(d_1,d_2,…,d_n)$中的每一个值$d_i$叫作一个分量　
- 基数(Cardinal number)
    - 一个域允许的不同取值个数 $D_i(i=1:n)$,基数为$m_i(i=1:n),D_1×D_2×…×D_n$ 的基数M为$M=∏_{i=1}^nmi$
- 关系是笛卡尔积的有限子集，取出有实际意义的元组来构造关系

关系：

- 关系的定义 :
    - $D1×D2×…×Dn$​的子集叫作在域$D1,D2,…,Dn$​上的关系，表示为 $R(D1，D2，…，Dn) $,R表示关系名n表示度
- 元组：
    - 关系中的每个元素是关系中的元组，通常用 𝑡t 表示。
- 单元关系与二元关系
    - $n=1$​，为单元关系或一元关系, 当$n=2$时，为二元关系
- 关系的表示
    - 关系也是一个二维表，表的每行对应一个元组，表的每列对应一个域
- 码
    - 候选码（Candidate key）
        - 若关系中的某一属性组的值能唯一地标识一个元组，而其子集不能，则该属性组为候选码 
    - 全码（All-key）
        - 关系模式的所有属性组是这个关系模式的候选码，称为全码（All-key）
    - 主码
        - 若一个关系有多个候选码，则选定其中一个为主码(Primary key) 
- 属性
    - 主属性 候选码的主属性称为主属性(Prime attribute)
    - 不包含在任何侯选码中的属性称为非主属性或非码属性
- 三类关系
    - 基本关系（基本表或基表）
        - 实际存在的表，是实际存储数据的逻辑表示
    - 查询表
        - 查询结果对应的表
    - 视图表
        - 由基本表或其他视图表导出的表，是虚表，不对应实际存储的数据
- 基本关系的性质
    - 列是同质的（Homogeneous）：每一列的分量都是同一类型的数据，来自同一个域
    - 不同的列可出自同一个域
    - 列的顺序无所谓，列的次序可以任意交换
    - 任意两个元组的候选码不能相同
    - 行的顺序无所谓，行的次序可以任意交换
    - 分量必须取原子值 这是规范条件中最基本的一条，即唯一的不能取两个或多个（即不能表中有表

## 2. 关系模式

### （1）关系模式含义

关系模式是型，关系是值，关系是关系模型的一个实例,关系模式是对关系的描述

### （2）定义关系模式

关系模式可以形式化地表示为：
$$
R(U，D，DOM，F)
$$

- R : 关系名 
- U : 组成该关系的属性名集合
- D : U中属性所来自的域 
- DOM : 属性向域的映象集合 
- F : 属性间数据的依赖关系的集合

也可表示为：R (U)或 R (A1，A2，…，An),A属性名

### （3）关系模式与关系

- 关系模式
    - 对关系的描述
    - 静态的、稳定的
- 关系
    - 关系模式在某一时刻的状态或内容
    - 动态的、随时间不断变化的

## 3. 关系数据库

- 在一个给定的应用领域中，所有关系的集合构成一个关系数据库
- 关系数据库的型
    - 关系数据库模式，是对关系数据库的描述，包括若干域的定义，以及在这些域上定义的若干关系模式，固定的
- 关系数据库的值
    - 关系模式在某一时刻对应的关系的集合，通常称为关系数据库，不稳定的

# **二、关系操作**

## 　1. 常用的关系操作 

- 查询操作：选择、投影、连接、除、并、差、交、笛卡尔积 

- 数据更新：插入、删除、修改

## 　2. 关系操作的特点 

- 集合操作方式：操作的对象和结果都是集合，一次一集合的方式
- 非关系操作是一次一条记录，如层次、网状模型

# ***\*三、关系的完整性\****

## 　1. 实体完整性

实体完整性规则（Entity Integrity）

- 若属性A是基本关系是基本关系R的主属性，则属性的主属性，则属性A不能取空值（候选码的属性都是主属性
- 实体完整性规则是针对基本关系而言的。 一个基本表通常对应现实世界的一个实体集。
- 现实世界中的实体是可区分的，即它们具有某种唯一性标识。
- 关系模型中以主码作为唯一性标识。

## 　2. 参照完整性

### （1）关系间的引用

- 在关系模型中实体及实体间的联系都是用关系来描述的，自然存在着关系与关系间的引用。

### （2）外码

- F是基本关系R的一个或一组属性，不是R的码(即主码)。 如果F与关系S的主码相对应，F是R的外码
- 基本关系R称为参照关系（Referencing Relation）
- 基本关系S称为被参照关系（Referenced Relation） 或目标关系（Target Relation）
- 关系R和S不一定是不同的关系
- 目标关系S的主码Ks 和参照关系的外码F必须定义 在同一个（或一组）域上
- 外码并不一定要与相应的主码同名 当外码与相应的主码属于不同关系时，往往取相同的名字，以便于识别

### （3）参照完整性规则

外码的取值：

- 空值，参照关系的外码属性组的每个属性值均为空值 
- 等于被参照关系中某个元组的主码值

## 　3. 用户定义完整性

针对某一具体关系数据库的约束条件，反映某一具体应用所涉及的数据必须满足的语义要求

关系模型应提供定义和检验这类完整性的机制， 以便用统一的系统的方法处理它们，而不需由应用程序承担这一功能

# **四、关系代数**

定义：关系代数是一种抽象的查询语言，它用对关系的运算来表达查询

关系代数运算三要素：

- 运算对象是关系
- 运算结果亦为关系
- 关系代数的运算符有两类：集合运算符和专门的关系运算符

传统的集合运算是从关系中行的角度进行

专门的关系运算涉及行和列

![img](https://img2020.cnblogs.com/blog/1861185/202004/1861185-20200424205345891-237020458.png)

# **五、传统集合运算**

- 并：$𝑅∪𝑆={𝑡|𝑡∈𝑅∨𝑡∈𝑆}R∪S={t|t∈R∨t∈S}$
- 差：$𝑅−𝑆={𝑡|𝑡∈𝑅∧𝑡∉𝑆}R−S={t|t∈R∧t∉S}$
- 交：$R∩S={t|t∈R∧t∈S}R∩S=R−(R−S)R∩S={t|t∈R∧t∈S}R∩S=R−(R−S)$
- 广义笛卡尔积：$R×S={t_rt_s|t_r∈R∧t_s∈S}R×S={t_rt_s|t_r∈R∧t_s∈S}$

# **六、专门关系运算** 

## 　1. 前置符号

- $R,t∈R,t[A_i]$​
    - 关系模式为$R(A_1,A_2,…,A_n)$它的一个关系设为R , t∈R表示 t是 R的一个元组 ，t[Ai] 则表示元组t中相应于属性Ai的一个分量
- $A , t[Ai] ,\overline{A}$
    - 若$A=\{A_{i1},A_{i2},…,A_{ik}\}$​，其中$A={A_{i1},A_{i2},…,A_{ik}}$​，是 A={Ai,Ai,…,Ai} 中的一部分，则𝐴A称为属性列或属性组。
    - $t[A]=(t[A_{i1}],t[A_{i2}],…,t[A_{ik}])$ 表示元组 t在属性列A上诸分量的集合。
    - $\overline{A}$​，则表示$\{𝐴_{1},𝐴_{2},…,𝐴_{𝑘}\}$​中去掉$\left\{A_{i 1}, A_{i 2}, \dots, A_{i k}\right\}$​​后剩余的属性组。
- $t_r$ 弧$t_s$​ 表示连接
- 象集
    - Zx={t[Z]|t∈R,t[X]=x} , 表示R中属性组X上值为x的诸元组在Z上分量的集合

## 　2. 选择(限制

- 在关系𝑅R中选择满足给定条件的诸元组$σ_F(R)={t|t∈R∧F(t)= true}$​
- $\sigma _F(R)$：选择条件，是一个逻辑表达式，取值为“真” 或“假”
- 基本形式为：𝑋1 θ 𝑌1
- θ 表示比较运算符，它可以是$＞，\geq，＜，\leq，＝＝$或<>
- X1 和 Y1 等是属性名，或为常量，或为简单函数；属性名也可以用它的序号代替
- 在基本选择条件上可以进行逻辑运算，非、与、或
- 选择运算是从行的角度进行的运算

## 　3. 投影

- R中选出若干属性列组成新关系$πAR)={t[A]|t∈R}$​ , A:R中的属性列
- 投影操作主要是从列的角度进行运算
- 投影之后不仅取消了原关系中的某些列，而且还可能取消某些元组（避免重复行）

## 　4. 连接

- $R \underset{A \theta B}{\bowtie} S=\left\{t_{r} t_{S} \mid t_{r} \in R \wedge t_{s} \in S \wedge t_{r}[A] \theta t_{S}[B]\right\}$
- A和B：分别为R和S上度数相等且可比的属性组
- θ：比较运算符
- 连接运算从R和S的广义笛卡尔积$R\times S$​中选取R关系在A属性组上的值与S关系在B属性组上的值满足比较关系θ的元组

### （1）等值连接

θ为＝的连接运算称为等值连接,即$R \underset{A \theta B}{\bowtie} S=\left\{t_{r} t_{S} \mid t_{r} \in R \wedge t_{s} \in S \wedge t_{r}[A] \theta t_{S}[B]\right\}$

### （2）自然连接

自然连接是一种特殊的等值连接

两个关系中进行比较的分量必须是相同的属性组

在结果中把重复的属性列去掉

R , S具有相同的属性组B , $R⋈S={tt,ts[U−B]|tr∈R∧ts∈S∧t[[B]=ts[B]}$

### （3）悬浮元组

两个关系R和S在做自然连接时，关系R中某些元组有可能在S中不存在公共属性上值相等的元组，

从而造成R中这些元组在操作时被舍弃了，这些被舍弃的元组称为悬浮元组。

### （4）外连接

- 如果把悬浮元组也保存在结果关系中，而在其他属性上填空值(𝑁𝑢𝑙𝑙)，就叫做外连接
- 左外连接: 只保留左边关系R中的悬浮元组
- 右外连接: 只保留右边关系S中的悬浮元组

## 　5. 除运算

给定关系𝑅(𝑋,𝑌)R(X,Y)和𝑆(𝑌,𝑍)S(Y,Z)，其中X,Y,Z 为属性组。

R中的Y与S中的Y可以有不同的属性名，但必须出自相同的域集。

R与S的除运算得到一个新的关系P(X)：

P是R中满足下列条件的元组在X属性列上的投影：

元组在X上分量值x的象集x包含S在Y上投影的集合，记作：

$$
R÷S={tr[X]|tr∈R∧πY(S)⊆Yx} 
$$


