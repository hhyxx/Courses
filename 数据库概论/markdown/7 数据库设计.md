# 一、数据库设计概述

## 1.数据库设计的特点

### （1）数据库建设的基本规律

- 数据的收集、整理、组织和不断更新

### **（2）**结构(数据)设计和行为(处理)设计相结合 

- 将数据库结构设计和数据处理设计密切结合
- 结构和行为分离的设计
- 传统的软件工程：重 行为设计
- 忽视对应用中数据语义的分析和抽象，只要有可能就尽量推迟数据结构设计的决策
- 早期的数据库设计：重 结构设计
- 致力于数据模型和数据库建模方法研究，忽视了行为设计对结构设计的影响

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522142309532-1809925249.png)

## 2.数据库设计方法

- 新奥尔良方法
- 基于E-R模型的设计方法
- 3NF的设计方法
- 面向对象的数据库设计方法
- 统一建模语言UML

## 3.数据库设计的基本步骤

- 需求分析
- 概念结构设计
- 逻辑结构设计
- 物理结构设计
- 数据库实施
- 数据库运行和维护

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522142551870-1292244843.png) 

**1.** 需求分析阶段

综合各个用户的应用需求

**2.** 概念结构设计阶段

形成独立于机器特点，独立于各个数据库管理系统产品的概念模式（**E-R**图）

**3.** 逻辑结构设计阶段

- 首先将**E-R**图转换成具体的数据库产品支持的数据模型，如关系模型，形成数据库逻辑模式
- 然后根据用户处理的要求、安全性的考虑，在基本表的基础上再建立必要的视图（**View**），形成数据的外模式

**4.** 物理结构设计阶段

根据数据库管理系统特点和处理的需要，进行物理存储安排，建立索引，形成数据库内模式

**5.** 数据库实施阶段

- 根据逻辑设计和物理设计的结果构建数据库
- 编写与调试应用程序
- 组织数据入库并进行试运行

**6.** 数据库运行和维护阶段

- 经过试运行后即可投入正式运行
- 在运行过程中必须不断对其进行评估、调整与修改

 ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522143723407-1034994517.png)

## 4.数据库设计的各级模式

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522143742167-1670731214.png) 

# 二、需求分析

## 1.需求分析的任务

（**1**）信息要求

用户需要从数据库中获得信息的内容与性质

由信息要求可以导出数据要求，即在数据库中需要存储哪些数据

（**2**）处理要求

用户要完成的处理功能

对处理性能的要求

（**3**）安全性与完整性要求

## 2.需求分析的方法

结构化分析方法（**Structured Analysis**，简称**SA**方法）

**SA**方法从最上层的系统组织机构入手

采用自顶向下、逐层分解的方式分析系统

## 3.数据字典

- 数据字典是关于数据库中数据的描述，即元数据，不是数据本身
- 数据字典在需求分析阶段建立，在数据库设计过程中不断修改、充实、完善
- 数据字典是进行详细的数据收集和数据分析所获得的主要结果

数据字典的内容：

- 数据项：名称类型长度等
- 数据结构：数据之间的结合关系
- 数据流：来源去向流量等
- 数据存储：存储名输入输出的数据流等
- 处理过程

数据字典通过对数据项和数据结构的定义来描述数据流、数据存储的逻辑内容

# 三、概念结构设计

## 1.概念模型

将需求分析得到的用户需求抽象为信息结构（即概念模型）的过程就是概念结构设计

特点：

（**1**）能真实、充分地反映现实世界，是现实世界的一个真实模型。

（**2**）易于理解，从而可以用它和不熟悉计算机的用户交换意见。

（**3**）易于更改，当应用环境和应用要求改变时，容易对概念模型修改和扩充。

（**4**）易于向关系、网状、层次等各种数据模型转换

## 2.E-R模型

用来描述概念模型

### （1）两个实体之间的联系

**①**一对一联系（**1**∶**1**）

如果对于实体集**A**中的每一个实体，实体集**B**中至多有一个（也可以没有）实体与之联系，反之亦然，则称实体集**A**与实体集**B具有一对一联系，记为**1**∶**1。

例如，学校里一个班级只有一个正班长，而一个班长只在一个班中任职，则班级与班长之间具有一对一联系。

**②**一对多联系（**1**∶**n**）

如果对于实体集**A中的每一个实体，实体集B中有n个实体（n≥0）与之联系，反之，对于实体集B中的每一个实体，实体集A中至多只有一个实体与之联系，则称实体集A与实体集B有一对多联系，记为1∶n**。

例如，一个班级中有若干名学生，而每个学生只在一个班级中学习，则班级与学生之间具有一对多联系。

**③**多对多联系（**m∶n**）

如果对于实体集**A中的每一个实体，实体集B中有n个实体（n≥0）与之联系，反之，对于实体集B中的每一个实体，实体集A中也有m个实体（m≥0）与之联系，则称实体集A与实体集B具有多对多联系，记为m∶n**。

例如，一门课程同时有若干个学生选修，而一个学生可以同时选修多门课程，则课程与学生之间具有多对多联系。

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522150646640-213836515.png)

 

### （**2**）两个以上的实体型之间的联系

 

一般地，两个以上的实体型之间也存在着一对一、一对多、多对多联系。

对于课程、教师与参考书**3**个实体型，如果一门课程可以有若干个教师讲授，使用若干本参考书，

而每一个教师只讲授一门课程，每一本参考书只供一门课程使用，则课程与教师、参考书之间的联系是一对多的

 ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522150751397-755113993.png)

### （**3**）单个实体型内的联系

同一个实体集内的各实体之间也可以存在一对一、一对多、多对多的联系。

例如，职工实体型内部具有领导与被领导的联系，即某一职工（干部）**“**领导**”**若干名职工，

而一个职工仅被另外一个职工直接领导，因此这是一对多的联系

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522150837902-150558162.png)

 

 

 

### （4）E-R图

**E-R**图提供了表示实体型、属性和联系的方法：

实体型：用矩形表示，矩形框内写明实体名。

属性：用椭圆形表示，并用无向边将其与相应的实体型连接起来。

例如，学生实体具有学号、姓名、性别、出生年份、系、入学时间等属性，用**E-R**图表示如图**
**

![img](https://img2020.cnblogs.com/blog/1861185/202007/1861185-20200701000925237-771218354.png)

联系：用菱形表示，菱形框内写明联系名，并用无向边分别与有关实体型连接起来，

同时在无向边旁标上联系的类型（**1 :** **1**，**1 :** **n**或**m :** **n**）。

联系可以具有属性

![img](https://img2020.cnblogs.com/blog/1861185/202007/1861185-20200701000843855-2015970111.png)

[实例]

某个工厂物资管理的概念模型。物资管理涉及的实体有：

- 仓库：属性有仓库号、面积、电话号码
- 零件：属性有零件号、名称、规格、单价、描述
- 供应商：属性有供应商号、姓名、地址、电话号码、账号
- 项目：属性有项目号、预算、开工日期
- 职工：属性有职工号、姓名、年龄、职称

实体之间的联系:

（1） 一个仓库可以存放多种零件，一种零件可以存放在多个仓库中，因此仓库和零件具有多对多的联系。用库存量

来表示某种零件在某个仓库中的数量。

（2） 一个仓库有多个职工当仓库保管员，一个职工只能在一个仓库工作，因此仓库和职工之间是一对多的联系。

（3） 职工之间具有领导与被领导关系。即仓库主任领导若干保管员，因此职工实体型中具有一对多的联系。

（4） 供应商、项目和零件三者之间具有多对多的联系。即一 个供应商可以供给若干项目多种零件，每个项目可以使

用不同供应商供应的零件，每种零件可由不同供应商供 给。

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522151552125-1552523501.png) 

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522151656357-1265650257.png)

 

 

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522151708717-121380111.png)

 

## 3. 概念结构设计

### （1）实体与属性的划分原则

为了简化**E-R**图的处理，现实世界的事物能作为属性对待的，尽量作为属性对待。

两条准则：

- 作为属性，不能再具有需要描述的性质。属性必须是不可分的数据项，不能包含其他属性。
- 属性不能与其他实体具有联系，即**E-R**图中所表示的联系是实体之间的联系。

**[例1]**

职工是一个实体，职工号、姓名、年龄是职工的属性。

- 职称如果没有与工资、福利挂钩，根据准则（**1**）可以作为职工实体的属性
- 如果不同的职称有不同的工资、住房标准和不同的附加福利，则职称作为一个实体更恰当

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522152130996-574088229.png)

 

 

**[例2]**

在医院中，一个病人只能住在一个病房，病房号可以作为病人实体的一个属性；

如果病房还要与医生实体发生联系，即一个医生负责几个病房的病人的医疗工作，则根据准则（**2**）病房应作为一个实体。

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522152215427-788432002.png)

 

**[例3]**

如果一种货物只存放在一个仓库，那么就可以把存放货物的仓库的仓库号作为描述货物存放地点的属性。

如果一种货物可以存放在多个仓库中，或者仓库本身又用面积作为属性，或者仓库与职工发生管理上的联系，

那么就应把仓库作为一个实体。

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522152252494-1976618655.png)

 

**[例7.1]** 

销售管理子系统E-R图的设计。

该子系统的主要功能是：

- 处理顾客和销售员送来的订单
- 工厂是根据订货安排生产的
- 交出货物同时开出发票
- 收到顾客付款后，根据发票存根和信贷情况进行应收款处理

参照需求分析和数据字典中的详尽描述，遵循前面给出的两个准则，进行了如下调整：

（**1**）每张订单由订单号、若干头信息和订单细节组成。订单细节又有订货的零件号、数量等来描述。按照准则**2**，

订单细节就不能作订单的属性处理而应该上升为实体。一张订单可以订若干产品，所以订单与订单细节两个实体之间是**1 :** **n**的联系。

 

 ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522152841439-364874813.png)

 

 

（**2**）原订单和产品的联系实际上是订单细节和产品的联系。每条订货细节对应一个产品描述，订单处理时从中获得当前单价、产品重量等信息。

（**3**）工厂对大宗订货给予优惠。每种产品都规定了不同订货数量的折扣，应增加一个**“**折扣规则**”**实体存放这些信息，而不应把它们放在产品实体中。

得到的E-R图如下：

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522152937063-303762503.png)

 

对每个实体定义的属性如下：

- 顾客：**{**顾客号，顾客名，地址，电话，信贷状况，账目余额**}**
- 订单：**{**订单号，顾客号，订货项数，订货日期，交货日期，工种号，生产地点**}**
- 订单细则：**{**订单号，细则号，零件号，订货数，金额**}**
- 应收账款：**{**顾客号，订单号，发票号，应收金额，支付日期，支付金额，当前余额，货款限额**}**
- 产品：**{**产品号，产品名，单价，重量**}**
- 折扣规则：**{**产品号，订货量，折扣**}**

**（2）ER图的集成**

**E-R**图的集成一般需要分两步

- 合并。解决各分**E-R**图之间的冲突，将分**E-R**图合并起来生成初步**E-R**图。
- 修改和重构。消除不必要的冗余，生成基本**E-R**图。

 ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522153123937-1736621374.png)

 

（**2**）合并**E-R**图，生成初步**E-R**图

各个局部应用所面向的问题不同，各个子系统的**E-R**图之间必定会存在许多不一致的地方，称之为冲突。

子系统**E-R**图之间的冲突主要有三类：

**①** 属性冲突

属性域冲突，即属性值的类型、取值范围或取值集合不同。

- 例如零件号，有的部门把它定义为整数，有的部门把它定义为字符型。
- 年龄，某些部门以出生日期形式表示职工的年龄，而另一些部门用整数表示职工的年龄。

属性取值单位冲突。

- 例如，零件的重量有的以公斤为单位，有的以斤为单位，有的以克为单位。

**②** 命名冲突

同名异义，即不同意义的对象在不同的局部应用中具有相同的名字。

异名同义（一义多名），即同一意义的对象在不同的局部应用中具有不同的名字。

- 如对科研项目，财务科称为项目，科研处称为课题，生产管理处称为工程。

命名冲突

- 可能发生在实体、联系一级上
- 也可能发生在属性一级上
- 通过讨论、协商等行政手段加以解决

**③** 结构冲突

同一对象在不同应用中具有不同的抽象。

- 例如，职工在某一局部应用中被当作实体，而在另一局部应用中则被当作属性。
- 解决方法：把属性变换为实体或把实体变换为属性，使同一对象具有相同的抽象。

同一实体在不同子系统的**E-R**图中所包含的属性个数和属性排列次序不完全相同。

- 解决方法：使该实体的属性取各子系统的**E-R**图中属性的并集，再适当调整属性的次序。

实体间的联系在不同的**E-R**图中为不同的类型。

- 实体**E1**与**E2**在一个**E-R**图中是多对多联系，在另一个**E-R**图中是一对多联系
- 解决方法是根据应用的语义对实体联系的类型进行综合或调整。

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522155124463-541353863.png)   ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522155129699-389747665.png)

 

 ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522155143940-1571168565.png)

 

（**2**）消除不必要的冗余，设计基本**E-R**图

- 所谓冗余的数据是指可由基本数据导出的数据，冗余的联系是指可由其他联系导出的联系。
- 消除冗余主要采用分析方法，即以数据字典和数据流图为依据，根据数据字典中关于数据项之间逻辑关系的说明来消除冗余。

如图**7.26**中，**Q3=Q1×Q2，Q4=∑Q5。所以Q3和Q4是冗余数据，可以消去。并且由于Q3消去，产品与材料间m:n的冗余联系也应消去。**

 ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522155917772-1338173099.png)

 

并不是所有的冗余数据与冗余联系都必须加以消除，有时为了提高效率，不得不以冗余信息作为代价。

用规范化理论来消除冗余

**①**确定分**E-R**图实体之间的数据依赖。

实体之间一对一、一对多、多对多的联系可以用实体码之间的函数依赖来表示。于是有函数依赖集**F****L**。

如图**7.27**中：

部门和职工之间一对多的联系可表示为：职工号**→**部门号职工和产品之间多对多的联系可表示为：

（职工号，产品号）**→**工作天数等。

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522160300288-260519422.png)

 

**②**求**FL**的最小覆盖**GL**，差集为 **D=FL-GL**。

逐一考察**D**中的函数依赖，确定是否是冗余的联系，若是，就把它去掉。

由于规范化理论受到泛关系假设的限制，应注意下面两个问题：

冗余的联系一定在**D**中，而**D**中的联系不一定是冗余的；

当实体之间存在多种联系时，要将实体之间的联系在形式上加以区分。

**[例7.2]** 

某工厂管理信息系统的视图集成。

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522160502885-591622115.png)

 

 

![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522160526532-1721584697.png)  ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522160536534-1896695127.png)

 

 ![img](https://img2020.cnblogs.com/blog/1861185/202005/1861185-20200522160552032-658444409.png)

 

 

异名同义，项目和产品含义相同。某个项目实质上是指某个产品的生产。统一用产品作实体名。

库存管理中职工与仓库的工作关系已包含在劳动人事管理的部门与职工之间的联系之中，所以可以取消。职工之间领导与被领导关系可由部门与职工（经理）之间的领导关系、部门与职工之间的从属关系两者导出，所以也可以取消。

## 
